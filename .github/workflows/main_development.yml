name: Main Development Workflow

on:
  workflow_dispatch:

jobs:
  # Test jobs - run before builds
  test-dotnet:
    uses: flyingdarts/flyingdarts/.github/workflows/backend/dotnet/test-dotnet.yml@main
    with:
      solution-file: "flyingdarts.sln"
      project-name: "flyingdarts"
      dotnet-version: "8.0.x"
      node-version: "22"

  test-flutter:
    uses: flyingdarts/flyingdarts/.github/workflows/frontend/flutter/test-flutter.yml@main
    with:
      project-name: "flyingdarts_mobile"
      project-directory: "apps/frontend/flutter/flyingdarts_mobile"
      flutter-version: "3.32.6"
      node-version: "22"

  test-rust:
    uses: flyingdarts/flyingdarts/.github/workflows/backend/rust/test-rust.yml@main
    with:
      project-name: "flyingdarts-authorizer"
      project-directory: "apps/backend/rust/authorizer"
      node-version: "22"

  test-angular:
    uses: flyingdarts/flyingdarts/.github/workflows/frontend/angular/test-angular.yml@main
    with:
      project-name: "fd-app"
      project-directory: "apps/frontend/angular/fd-app"
      configuration: "development"
      node-version: "22"

  # Build jobs - run after tests pass
  build-deploy-dotnet-dev:
    name: Build .NET
    needs: [test-dotnet]
    uses: flyingdarts/flyingdarts/.github/workflows/backend/dotnet/main_dotnet_dev.yml@main
    secrets: inherit

  build-flutter-dev:
    name: Build Flutter
    needs: [test-flutter]
    uses: flyingdarts/flyingdarts/.github/workflows/frontend/flutter/main_flutter_dev.yml@main
    secrets: inherit

  build-rust-dev:
    name: Build Rust
    needs: [test-rust]
    uses: flyingdarts/flyingdarts/.github/workflows/backend/rust/main_rust_dev.yml@main
    secrets: inherit

  build-angular:
    name: Build Angular
    needs: [test-angular] # Angular might depend on .NET backend
    uses: flyingdarts/flyingdarts/.github/workflows/frontend/angular/ci-angular-app-development.yml@main
    secrets: inherit
